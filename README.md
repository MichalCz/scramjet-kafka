# Scramjhet

A simple module that exposes some simple methods to work with Kafka topics using {@link <https://scramjet.eu/> scramjet}.

Installation:

 $ npm install --save scramjet-kafka

Here's a sample case of augmenting a topic using an API: calcalutation of all transactions to a single currency in your kafka topic

```javascript
  await (
      require('scramjet-kafka')
          .consume(
              "zk-kafka01.local:2021",      // Zookeeper connection string
              "transactions"                // Topic
          )
          .assign(                          // assign the calcalutation data
              async (transaction) => {
                  if (transaction.currency === "EUR") return { eur_value: transaction.value };
                  const exchange_rate = await getCurrencyExchangeRate(transaction.currency, "EUR");
                  return {
                      eur_value: exchange_rate * transaction.value
                  }
              }
          )
          .produce(                           // produce new topic with augmented data
              "zk-kafka01.example.com:2021",
              "transactionsInEUR"
          )
  );
```

Or an even simpler version:

```javascript
await (
    require('scramjet-kafka').augment(
        "zk-kafka01.local:2021",      // Zookeeper connection string
        "transactions",               // From Topic
        (stream) => stream            // Transform the stream however you like
            .assign(async (transaction) => ({
                eur_value: await getEURValue(transaction.value, transaction.currency)
            })),
        "transactionsInEUR"           // To Topic
    )
);
```

# Documentation

<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

### Table of Contents

-   [KafkaStream](#kafkastream)
    -   [connect](#connect)
    -   [addTopics](#addtopics)
    -   [removeTopics](#removetopics)
    -   [commit](#commit)
    -   [setOffset](#setoffset)
-   [plugin](#plugin)
    -   [viaKafka](#viakafka)
    -   [produceKafka](#producekafka)
-   [sjKafka](#sjkafka)
-   [augment](#augment)
-   [consume](#consume)

## KafkaStream

**Extends DataStream**

A [scramjet.DataStream](../scramjet/blob/master/docs/data-stream.md) augmented with Kafka specific methods.

**Parameters**

-   `options`  
-   `consumerOptions` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** Consumer options (optional, default `{}`)
-   `streamOptions` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** Options passed to scramjet

### connect

Opens up connection to kafka and starts streaming.

### addTopics

Add topics to the stream

**Parameters**

-   `topics` **[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;([String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String) | Topic)>** list of topics to listen on
-   `args` **[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)** additional arguments to `ConsumerStream::addTopics`

### removeTopics

Removes topics from the stream

**Parameters**

-   `topics` **[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)>** list of topics to remove

### commit

Commits at the current position

### setOffset

Sets read offset at current position

**Parameters**

-   `topic` **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** topic name in kafka
-   `partition` **[Number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** where to start reading
-   `offset` **[Number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** kafka partition number

## plugin

[Scramjet StringStream](https://scramjet.eu/docs/string-stream.html) plugin - the following methods are added
to all scramjet streams

### viaKafka

Plugin to scramjet::StringStream - push to kafka and pull on the other end.

This may be used to allow burst flow above memory limits.

**Parameters**

-   `client` **(Client | KafkaClient)** KafkaNode client to Zookeeper or direcly Kafka
-   `topic` **([String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String) | Topic)** topic - will be autogenerated if not given (optional, default `null`)

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)** resolved when fromTopic stream ends.

### produceKafka

Send the stream to the specified Kafka topic.

**Parameters**

-   `client` **(Client | KafkaClient)** KafkaNode.client
-   `topic` **([String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String) | Topic)** topic - will be autogenerated if not given (optional, default `null`)

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)** resolved when fromTopic stream ends.

## sjKafka

Scramjet Kafka module exports

Type: [Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)

## augment

Fetches a stream from Kafka topic performs declared operations and publishes to the another topic.

The transforms as in scramjet can be asynchronous, synchronous, even multi-threaded.

{@see <https://scramjet.eu/> Scramjet documentation}

**Parameters**

-   `client` **(Client | KafkaClient)** KafkaNode client to Zookeeper or direcly Kafka
-   `fromTopic` **([String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String) | Topic)** topic to consume
-   `use` **UseCallback** transforms callback or scramjet module
-   `toTopic` **([String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String) | Topic)** topic to produce3

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)** resolved when fromTopic stream ends.

## consume

Consume a topic from kafka and return a new KafkaStream

**Parameters**

-   `client` **(Client | KafkaClient)** KafkaNode client to Zookeeper or direcly Kafka
-   `topics` **[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;([String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String) | Topic)>** Topics to pull from Kafka (optional, default `[]`)

## 

**Properties**

-   `topic` **[String](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** topic name in kafka
-   `offset` **[Number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** where to start reading
-   `partition` **[Number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** kafka partition number

# License

MIT - [see LICENSE](./LICENSE)
